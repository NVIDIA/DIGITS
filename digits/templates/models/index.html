{# Copyright (c) 2015, NVIDIA CORPORATION.  All rights reserved. #}

{% extends "layout.html" %}

{% block head %}
<script src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.buttons.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/buttons.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/buttons.colVis.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dataTables.fixedHeader.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/table.js') }}"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/dataTables.bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.bootstrap.min.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/fixedHeader.bootstrap.min.css') }}">
{% endblock %}

{% block content %}

<div class="page-header">
    <div class="row">
        <div class="pull-right">
            <a id="delete-job" class="btn btn-danger">Delete Selected Jobs</a>
        </div>
        <h1>Models</h1>
    </div>
</div>

<script>
 $('#delete-job').on('click', function(event) {

     var table = $('#job_table').dataTable();
     var list = table._('tr', {"filter":"applied"});

     if (list.length == 0) {
         return;
     }
     bootbox.confirm(
         'Are you sure you want to delete ' + list.length + ' jobs?<br><br>All related files will be permanently removed.',
         function(result) {
             if (result) {
                 for (var i = 0; i < list.length; i++) {
                     var job_id = list[i][1];
                     var url = '/jobs/' + job_id

                     if (i == list.length-1) {
                         $.ajax(url, {type: "DELETE"})
                          .done(function(data) {
                              // refresh the page only after the last delete has completed
                              window.location.reload(1);
                          })
                          .fail(function(data) {
                              errorAlert(data);
                          });
                     } else {
                         $.ajax(url, {type: "DELETE"})
                          .fail(function(data) {
                              errorAlert(data);
                          });
                     }
                 }
             }
         });
 });
</script>


{% if jobs|length > 0 %}
<div class="row">
    <table id="job_table" class="table" width="100%">
        <thead>
            <tr>
                <th>Name</th>
                <th>ID</th>
                <th>Framework</th>
                <th>Status</th>
                <th>Runtime</th>
                {% for attrib in attrs_and_labels %}
                <th>{{ attrib[2]|capitalize|e }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tfoot>
            <tr>
                <th>Name</th>
                <th>ID</th>
                <th>Framework</th>
                <th>Status</th>
                <th>Runtime</th>
                {% for attrib in attrs_and_labels %}
                <th>{{ attrib[2]|capitalize|e }}</th>
                {% endfor %}
            </tr>
        </tfoot>
        <tbody>
            {% for job in jobs %}

            {% set job_info = job[0] %}
            {% set job_attrs = job[1] %}

            <tr class="{{ job_info.status.css }}">
                <td><a href="{{ job_info.id }}">{{ job_info.name|e }}</a></td>
                <td>{{ job_info.id }}</td>
                <td>{{ job_info.framework_id }}</td>
                <td>{{ job_info.status.name }}</td>
                <td>{{ job_info.time }}</td>
                {% for attrib in attrs_and_labels %}
                {% if job_attrs[attrib[0]] is defined %}
                <td>{{ job_attrs[attrib[0]][attrib[1].name] }}</td>
                {% else %}
                <td>&nbsp;</td>
                {% endif %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<i>None</i>
{% endif %}

{% endblock %}
